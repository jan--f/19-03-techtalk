<!-- .slide: data-state="cover" id="prometheus-cover-page" data-timing="20" data-menu-title="Monitoring Ceph with Prometheus" -->

<div class="title">
    <h1>Monitoring Ceph with Prometheus</h1>
    <h2></h2>
</div>

<div class="row presenters">
    <div class="presenter presenter-1">
        <h3 class="name">Jan Fajerski</h3>
        <h3 class="job-title">Senior Software Engineer</h3>
        <h3 class="email"><a href="mailto:jan.fajerski@suse.com">jan.fajerski@suse.com</a></h3>
    </div>
</div>


<!-- .slide: data-state="normal" id="agenda" data-menu-title="Agenda" -->
## Motivation

Intro to Prometheus and Grafana and provide enough info to customize the default
monitoring stack for a given cluster

## Agenda

* **Grafana**

* **Prometheus**
  * Intro
  * Exporters
  * Configuration
  * Deployment considerations
  * Query language
  * Alerting


<!-- .slide: data-state="normal" id="grafana-intro" data-timing="30" -->
## Grafana
<h3>
<q>
The open platform for beautiful analytics and monitoring.
</q>
</h3>

* Time-series data visualization
* Started in 2012 by Torkel Ã–degaard
* Supports many data sources (55 as of March 2019)
* Many features (most we won't use here)


<!-- .slide: class="full-screen" data-state="normal" id="grafana-dash" data-timing="30" -->
<img src="https://raw.githubusercontent.com/ceph/ceph/master/monitoring/grafana/screenshots/ceph-cluster1.png" />


<!-- .slide: class="full-screen" data-state="normal" id="grafana-dashs" data-timing="30" -->
<img src="images/grafana-dashboards.png" />


<!-- .slide: data-state="normal" id="prometheus-intro" data-timing="30" style="z-index:1;"-->
## Prometheus

<h3>
<q>
A leading open-source monitoring solution.
</q>
</h3>

* Originally developed at SoundCloud (started 2012), inspired by Borgmon
* CNCF member project (2nd ever Incubator Project)
* Built for highly-dimensional (_numerical_) data, simple operations, scalability
* Powerful query language
* Widely adopted

<img class="fragment" data-src="images/prom-users.png" style="height: 600px; position: absolute;
top: 200px; left: 400px; z-index:0;"/>

<img class="fragment" data-src="images/SUSE/SUSE-logo.svg" style="width: 200px; position: absolute;
top: 500px; left: 100px; z-index:0;"/>

Note:
* scalability often considered to be a result of the pull based model
* also users: SUSE and most SES customers
* _NOT_ a log analysis system!!!


<!-- .slide: data-state="normal" id="alertmanager-intro" data-timing="30" -->
## Alertmanager

<h3>
<q cite="https://github.com/prometheus/alertmanager">
The Alertmanager handles alerts sent by client applications such as the Prometheus server. It takes care of deduplicating, grouping, and routing them to the correct receiver integrations such as email, PagerDuty, or OpsGenie. It also takes care of silencing and inhibition of alerts.
</q>
</h3>

* Only component aware of clustering
* Typically deployed alongside Prometheus
* Part of the Prometheus project
* Can be used without Prometheus
* _add http interface pic_

Note:
* cli flags for clustering; list of peers to query.
* Alerts are generated by Prometheus
* Prometheus interacts with Alertmanagers http API


<!-- .slide: data-state="normal" id="exporters-intro" data-timing="30" -->
## Exporters

* Simple plain-text interface via HTTP
* _A lot_ of [existing exporters](https://github.com/prometheus/docs/blob/master/content/docs/instrumenting/exporters.md)

<div class="slide-section fragment" style="padding-top: 40px; padding-left:130px">
<pre>
<code class="html hljs">
\# TYPE ceph_my_metric counter
\# HELP ceph_my_metric metric description
ceph_my_metric{labelname="labelvalue", ...} metric_value
</code>
</pre>
</div>

<p class="fragment" style="padding-top: 200px;">More on writing exporters: https://prometheus.io/docs/instrumenting/writing_exporters/</p>

Note:
* We will only use the node_exporter and the mgr module
* Ideally code is instrumented directly, client libraries exist
